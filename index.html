<!DOCTYPE html>
<html>
	<head>
		<title>경북대 점심, 뭐 먹지?</title>
		<link rel="stylesheet" type="text/css" href="./my_css_pc.css">
		<link rel="stylesheet" type="text/css" media="(max-aspect-ratio:1/1)"href="./my_css_mobile.css">
		<script async custom-element="amp-ad" src="https://cdn.ampproject.org/v0/amp-ad-0.1.js"></script>
	</head>
	<body>
	<form method="get" action="./">
	<div id="gate_div" style="display:flex">
	    	<div class="gate">
		</div>
		<div class="gate">
			<input type="checkbox" name="north_gate" id="north_gate" style="float:right;" value="FALSE"></input>
			<label for="north_gate">북문근처</label>
		</div>
		<div class="gate">
			<input type="checkbox" name="main_gate" id="main_gate" style="float:right;" value="FALSE"></input>
			<label for="main_gate">정문근처</label>
		</div>
	</div>
	<div id="food_div">
		<div id="img_div">
			<img id='myImg'>
		</div>
		<p id='food_name' class="center" style="font-size:4vmin;"></p>
	</div>
	<div id="map_div">
		<div id="map"></div>
	</div>
	<div id="button_div">
		<center>
		<form>
			<input type="submit" value="다시 뽑기" style="font-size:4vmin; box-shadow: 0 12px 16px 0 rgba(0,0,0,0.2),0 17px 50px 0 rgba(0,0,0,0.19);">
		</form>
		</center>
	</div>
	</form>
	<amp-ad
		layout="fixed"
		width="728"
		height="90"
		type="adsense"
		data-ad-client="ca-pub-5536191614660236"
		data-ad-slot="6180812541">
	</amp-ad>

	<script src="PapaParse-5.0.2/papaparse.js"></script>
	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=488b379934773e65aefc9613887e9c91"></script>
	<script>
		function getUrlParams() {
			var params = {};
			window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(str, key, value) { params[key] = value; });
			return params;
		};

		var my_params=getUrlParams()

		if (typeof my_params.north_gate === "undefined"){
			my_params.north_gate="TRUE";
		};

		if (typeof my_params.main_gate === "undefined"){
			my_params.main_gate="TRUE";
		};
		
		if (my_params.north_gate == "FALSE") {
			document.querySelector('input[name=north_gate]').checked = 1;
		}

		if (my_params.main_gate == "FALSE") {
			document.querySelector('input[name=main_gate]').checked = 1;
		}

		function getData(callbackFunc){
			Papa.parse("data.csv", {
				download: true,
				header: true,
				complete: function(results) {
					callbackFunc(results.data);
					}
				}
			);
		};

		getData( function(csvdata){
			csvdata = csvdata.filter( (d) => { (d.north_gate === my_params.north_gate) && (d.main_gate === my_params.main_gate) });
			var img_cnt = csvdata.length;
			var rand_num = Math.floor(Math.random() * (img_cnt - 1));
			var img = document.getElementById("myImg");
			img.setAttribute('src',csvdata[rand_num].imgs);
			var foodname = document.getElementById('food_name');
			foodname.innerHTML = csvdata[rand_num].foodnames;

			var container = document.getElementById('map');
			var options = {
				center: new kakao.maps.LatLng(
					parseFloat(csvdata[rand_num].lat),
					parseFloat(csvdata[rand_num].lon)),
				 level: 3
			};
			var map = new kakao.maps.Map(container, options);
			var markerPosition  = new kakao.maps.LatLng(
					parseFloat(csvdata[rand_num].lat),
					parseFloat(csvdata[rand_num].lon));
			var marker = new kakao.maps.Marker({
				position: markerPosition
			});
			marker.setMap(map);
		});
	</script>
	</body>
</html>
